---
title: "Forestplots"
output:
  html_document:
    toc: false
    number_sections: false
    df_print: paged
    code_download: true
    highlighter: null
---

```{r setup, eval=TRUE, include=FALSE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE, cache=TRUE, fig.align='center', comment=""}
chooseCRANmirror(graphics=FALSE, ind=133)
source("source/plots-overview.R")
```
___

Page last updated: `r format(Sys.time(), '%d %B, %Y')`

\  

# Examples {#forestplot .tabset}

For these plots we will use the [basic data](#simple_data).

```{r eval=TRUE, include=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE, cache=TRUE, fig.align='center', comment=""}
head(data)
```

\  

## ggforestplot {#ggforestplot}
The following packages are required to make the below forestplot: `ggplot2` and `ggforestplot`. We also set two variables `ci` and `psignif` which act to set the confidence interval and significance threshold for the plot. If significance threshold is met then a solid point is plotted.

```{r ggforestplot, eval=TRUE, include=TRUE, echo=TRUE, error=FALSE, message=FALSE, warning=FALSE, cache=TRUE, fig.align='center', comment=""}
##### Packages
library(ggplot2)
library(ggforestplot)

##### Plotting variables
ci <- 0.95
psignif <- 0.05

##### Plot
forestplot(df = data, 
           name = name, 
           estimate = estimate, 
           se = se, 
           pvalue = p, 
           colour = group, 
           shape = NULL, 
           logodds = FALSE, 
           psignif = psignif, 
           ci = ci, 
           title = "Forestplot",
           xlab = "Forestplot with 95% CI") +
  scale_color_manual(values = discrete_wes_pal) +
  theme(
    legend.position = "bottom",
    legend.title.align = 0,
    legend.text.align = 0,
    legend.title = element_blank(),
    axis.title.x = element_text(hjust = 0.5)
  ) 
```

\  

## ggforestplot loop {#ggforestplot_loop}

You can make multiple forestplots if you have groups or subgroups within your data frame using a `for()` loop. You can arrange the plots using the package `cowplot` and the function `plot_grid()`.

```{r ggforestplot_loop, eval=TRUE, include=TRUE, echo=TRUE, error=FALSE, message=FALSE, warning=FALSE, cache=TRUE, fig.align='center', comment=""}
##### Packages
library(cowplot)

##### Plotting variables
ci <- 0.95
psignif <- 0.05
plots <- list()

##### Plot
for (i in levels(data$subgroup)){
  df <- subset(data, subgroup == i)

 p <- forestplot(df = df, 
           name = name, 
           estimate = estimate, 
           se = se, 
           pvalue = p, 
           colour = group, 
           shape = NULL, 
           logodds = FALSE, 
           psignif = psignif, 
           ci = ci, 
           title = i,
           xlab = "Forestplot with 95% CI") +
     scale_color_manual(values = discrete_wes_pal) +
  theme(
    legend.position = "bottom",
    legend.title.align = 0,
    legend.text.align = 0,
    legend.title = element_blank(),
    axis.title.x = element_text(hjust = 0.5)
  ) 

  
  plot_name <- paste0("p",i)
  plots[[plot_name]] <- p
}

##### Use cowplot to combine multiple plots
plot_grid(plots[["p1"]], plots[["p2"]], ncol = 2)
```

